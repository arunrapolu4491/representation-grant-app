#!/bin/bash
# Work around for Vue having a lack of a configurable publicPath that isn't relative (relative breaks history routing).
# Unfortunately there doesn't seem to be an easier way of doing this without rebuilding.
# Since we have a single web image, doesn't make sense to build the web-artifacts twice. 
# Perhaps webpack 5 will have some sort of fix for this. 
echo "---> Replacing public path /RECAPTCHA_SITE_KEY/ -> $VUE_APP_RECAPTCHA_SITE_KEY in Vue artifacts..."
FILES="/tmp/app/dist/web/src/components/home/Feedback.vue"
for f in $FILES
do
	tmp=$(sed "s|/RECAPTCHA_SITE_KEY/|$VUE_APP_RECAPTCHA_SITE_KEY|g" "$f"); 
	printf "%s" "$tmp" > "$f";
done

/usr/libexec/s2i/run